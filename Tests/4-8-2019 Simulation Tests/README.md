## Simulation Tests 3/1/2019

#### Testing Setup and Protocol
The goal of the simulated tests was to test the functionality of the conventional beamforming software to correctly detect angles corresponding to phase differences of simulated radio waves. The tests were first performed with radio waves created from GNU Radio software using the signal source block. Since it was unclear how to set an exact frequency of 433.92 mHz using the signal source GNU Radio block, a sinusoidal wave from a CC1310 was used to provide the source of the simulated radio waves instead. The CC1310 signal would be split into two in-phase/quadrature data channels to provide inputs to the principal component analysis block which computed a phase difference for angle of arrival (AoA) calculation.

In order to create a phase offset between the split data channels, the Multiply EXP GNU Radio block was used to continuously adjust the phasor of one of the data channels to have a specific phase difference. Phase offset arguments of 3.14159, 2.72070, 2.22144, 1.57080, and 0.00000 radians were used corresponding to 0, 30, 45, 60, and 90 degree angles of arrival respectively. Phase offset arguments were calculated from the AoA formula arccos(phase_difference/(2*pi*alpha)) where alpha is equal to wavelength/antenna_seperation.

#### Results
Five tests with three trials were performed for each AoA. In these tests, alpha values used in calculating AoA were adjusted to 0.45, 0.48, 0.5, 0.52, and 0.55 to see how the program would react to inaccuracy in antenna seperation. The results of each test were processed automatically into txt files with names denoting the ExpectedAoAValue (e.g."angle0"), the alpha value (e.g."alpha0_45" for 0.45), and "cc1310" because each test was performed with the CC1310.	
	
#### Discussion
The program calculated phase difference perfectly in each test with values being equal to the phase offset arguments used in the Multiply EXP block. The AoAs for each test that had alpha values of 0.5 (exact half-wavelength spacing) were almost equal (+/- 0.1 degree maximum difference) to the expected angles of arrival for 0, 30, 45, 60 and 90 degrees. The manipulation of alpha yielded interesting results for AoA calculation. AoA calculations are more inaccurate as expected AoA decreases from 90 to 0 degrees for imperfect alpha values. This addresses the  limitation of conventional beamforming to acquire accurate results when the transmitter is near 0 or 180 degree AoA due to increased sensitivity at these angles. 

To test the correctness of the phase-difference to AoA calculation in the software, the AoA values calculated by the program were crosschecked with the formula arccos(phase_difference/(2*pi*alpha)). The values calculated by both procedures for each expected AoA/alpha value were equal, demonstrating the mathematical correctness of the software. Furthermore, alpha values of 0.45 and 0.48 for 0 degrees AoA generate unexpectant angles of 0 degrees because these parameters generate arguments greater than 1 in the arccosine function which would cause a domain error. Instead of generating a domain error for these parameters (which occurs because the formula only considers half-wavelength spacing or lower), the program generates an angle of 0 when the argument of the arccosine function goes above 1.

Although there was disparity for results at different alpha values, this disparity alone does explain the much greater inaccuracy of AoAs calculated in the outdoor test. Error combinations of low resolution AoA (with half-wavelength spacing), antenna seperation inaccuracy, and multipath interference from the tester/testing equipment may collectively contribute to the problem. Low resolution in conventional beamforming is explored more in this [paper](https://core.ac.uk/download/pdf/78066545.pdf) which demonstrates how lower antenna seperation causes lower resolution. The paper also posits using a combination of phase ambiguous 8-wavelength spacing and low resolution 0.5 wavelength spacing to tackle this problem. However, due to the precision of the results generated in the outdoor test, it can be argued that low resolution is not one of the causes of the problem. Antenna seperation inaccuracy can be investigated further by another outdoor test, in which I/Q values are collected from both antennas to see if recalculating results (with different parameters including antenna spacing) generates noticable changes. Finally, multipath interference can be investigated by seeing if AoA values fluctuate when the tester moves in a crouched position near the testing rig.
